#!/usr/bin/python
#
#
#Creation Date - 03/05/2017
#Latest update added Git Pull Requests
#Last Modified - 19/07/2017
#Python Pentest Menu 
#Version 2.0
#Latest mod Added Workspace Support (19/07/2017)




#Imports
import datetime
import os
import subprocess
import time
import shlex

#Define Colours
def prRed(prt): print("\033[91m {}\033[00m" .format(prt))
def prGreen(prt): print("\033[92m {}\033[00m" .format(prt))
def prYellow(prt): print("\033[93m {}\033[00m" .format(prt))
def prLightPurple(prt): print("\033[94m {}\033[00m" .format(prt))
def prPurple(prt): print("\033[95m {}\033[00m" .format(prt))
def prCyan(prt): print("\033[96m {}\033[00m" .format(prt))
def prLightGray(prt): print("\033[97m {}\033[00m" .format(prt))
def prBlack(prt): print("\033[98m {}\033[00m" .format(prt))

#Set Globals for Workspace to 0
workspace = 0
absolute_path = 0


#Initally clear the screen
os.system('clear')

#Define Option 0 - Create a Workspace
def workspace_menu():
    print "Enter the name of the Workspace or type 'q' or 'quit' to return to the main menu"
    print ""
    workspace_input = raw_input(":")
    if workspace_input in ("q", "quit"):
        os.system('clear')
    else:
#Define the current working directoy (__file__)
        script_dir = os.path.dirname(__file__)
        relative_path = 'workspaces/'
        joined_path = os.path.join(script_dir, relative_path)
        os.chdir(joined_path)
        if os.path.exists(workspace_input):
            print "Directory already Exists! - Try a different name"
            raw_input("Press any key to Return to the Main Menu")
            os.system('clear')
        else:
            make_path = os.makedirs(workspace_input)
            absolute_path = joined_path + workspace_input
            global absolute_path
            absolute_path = absolute_path
            global workspace
            workspace = 1
            print "Workspace created!", absolute_path
            raw_input("Press any Key to Continue")
            os.system('clear')

#Define the Main Menu
def menu():
    prGreen("#########################################################")
    prPurple("Welcome to the t0ast Pentest Menu!")  
    prPurple("Please select from the following using numerical values")
    prGreen("#########################################################")
    print "                                  ", datetime.datetime.now()
    prCyan(" 0) Add a Workspace")
    prLightPurple(" 1) System Tasks")
    prLightPurple(" 2) Application Specific Tasks")
    prLightPurple(" 3) Brute Forcers")
    prLightPurple(" 4) Enumeration Tools")
    prLightPurple(" 5) Exploitation Tools")
    prLightPurple(" 6) Evasion Tools")
    prLightPurple(" 7) Password Cracking Tools")
    prLightPurple(" 8) VPN Tools")
    prRed("11) Exit")
    

#Define System Tasks
def system_tasks():
    os.system('clear')
    prGreen("#########################################################")
    prPurple("Welcome to the t0ast Pentest Menu!")
    prPurple("Choose the appropriate website testing tool")
    print ""
    prLightPurple(" 1) Display Local Network information")
    prLightPurple(" 2) Github Branches (Update)")
    prLightPurple(" 3) Local System (Update)")
    prYellow(" 4) Back")
    system_tasks_answer = input(":")
    if system_tasks_answer ==1:
        print "The Local Network Configuration of this OS are:"
        print ""
        ifconfig = subprocess.call(['/sbin/ifconfig'])
        dns = subprocess.call(['cat', '/etc/resolv.conf'])
        print ""
        lni_menu = raw_input("Press any Key to Continue")
        system_tasks()
        os.system('clear')
    elif system_tasks_answer ==2:
        print "Update All Github Repos in the local tools directory"
        git = subprocess.call('find ./tools -name .git -type d | xargs -n1 -P4 -I% git --git-dir=% --work-tree=%/.. remote update -p', shell=True)
        system_tasks()
        os.system('clear')
    elif system_tasks_answer ==3:
        print "Running Update from Repos on Local System"
        os.system('apt-get update && apt-get upgrade')
        print ""
        local_update = raw_input("Press any key to continue")
        system_tasks()
        os.system('clear')
    elif system_tasks_answer ==4:
        os.system('clear')
    else:
        raw_input("You did not give a valid answer, press any key to try again")
        os.system('clear')

#Define Application Specific Tools - Level 1
def app_specific_tools_level_1():
    os.system('clear')
    prGreen("#########################################################")
    prPurple("Welcome to the t0ast Pentest Menu!")
    prPurple("Choose an applications tool")
    print ""
    prLightPurple(" 1) Wordpress Tools")
    prYellow(" 2) Back")
    app_specific_tools_level_1_answer = input(":")
    if app_specific_tools_level_1_answer ==1:
        app_specific_tools_level_2()
    elif app_specific_tools_level_1_answer ==2:
        os.system('clear')
    else:
        raw_input("You did not give a valid answer, press any key to try again")
        os.system('clear')
        app_specific_tools_level_1()
        
#Define Application Specific Tools - Level 2
def app_specific_tools_level_2():
    os.system('clear')
    prGreen("#########################################################")
    prPurple("Welcome to the t0ast Pentest Menu!")
    prPurple("Choose an WorddPress Sepcific tool")
    print ""
    prLightPurple(" 1) Wordpress XML RPC Brute Forcer")
    prLightPurple(" 2) WPFORCE")
    prLightPurple(" 3) WPSCAN")
    prLightPurple(" 4) WPSPLOIT")
    prLightPurple(" 5) WPWNER")
    prYellow(" 6) Back")
    app_specific_tools_level_2_answer = input(":")
    if app_specific_tools_level_2_answer ==1:
        try:
            app = "./tools/2-application-specific-tools/wordpress/Wordpress-XMLRPC-Brute-Force-Exploit/wordpress-xmlrpc-brute-v2.py"
            app_split = shlex.split(app)
            print "Enter XML File path followed by Wordlist followed by usename with spaces in between each"
            command_line1 = raw_input()
            xml_args = shlex.split(command_line1)
            wordlist = "./wordlists/SecLists/Passwords/rockyou.txt"
            ws_args = shlex.split(wordlist)
            print "Enter the name of the user to test"
            command_line2 = raw_input()
            user_args = shlex.split(command_line2)
            s = app_split + xml_args + ws_args + user_args
            x = subprocess.call(s)
            raw_input("Press any key to return to the menu")
            os.system('clear')
            app_specific_tools_level_2()
        except KeyboardInterrupt:
            os.system('clear')
            app_specific_tools_level_2()
    elif app_specific_tools_level_2_answer ==2:
        try:
            print "WPForce Menu"
            app = "python ./tools/2-application-specific-tools/WPForce/wpforce.py"
            app_args = shlex.split(app)
            print "Usage Menu"
            print "Usage: wpforce.py [-h] -i INPUT -w WORDLIST -u URL [-v] [-t THREADS] [-a AGENT] [-d]"
            print ""
            print "Enter the Input command [-i]"
            command_input1 = "-i " + raw_input()
            command1_args = shlex.split(command_input1)
            wordlist = "-w ./wordlists/SecLists/Passwords/rockyou.txt"
            wl_args = shlex.split(wordlist)
            print "Enter the name of the URL to test [-u]"
            command_input2 = "-u " + raw_input()
            url_args = shlex.split(command_input2)
            threads = "15"
            threads_args = shlex.split(threads)
            agent = '"-a Mozilla/5.0 (iPad; U; CPU OS 3_2_1 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Mobile/7B405"'
            agent_args = shlex.split(agent)
            debug = "-d"
            debug_args = shlex.split(debug)
            s = app_args + command1_args + wl_args + url_args + agent_args + debug_args
            print s
            x = subprocess.call(s)
            print ""
            raw_input("Press any key to return to the menu")
            os.system('clear')
            app_specific_tools_level_2()
        except KeyboardInterrupt:
            os.system('clear')
            app_specific_tools_level_2()
    elif app_specific_tools_level_2_answer ==3:
        print "add full path3"
        os.system('clear')
    elif app_specific_tools_level_2_answer ==4:
        print "add full path4"
        os.system('clear')
    elif app_specific_tools_level_2_answer ==5:
        print "add full path5"
        os.system('clear')
    elif app_specific_tools_level_2_answer ==6:
        app_specific_tools_level_1
        os.system('clear')
    else:
        raw_input("You did not give a valid answer, press any key to try again")
        os.system('clear')
        
#Define Brute Forcers Menu
def brute_forcers():
    os.system('clear')
    prGreen("#########################################################")
    prPurple("Welcome to the t0ast Pentest Menu!")
    prPurple("Choose the appropriate Brute Force testing tool")
    print ""
    prLightPurple(" 1) Medusa")
    prLightPurple(" 2) Patator")
    prYellow(" 3) Back")
    brute_forcers_answer = input(":")
    if brute_forcers_answer ==1:
        print "add full path1"
        os.system('clear')
    elif brute_forcers_answer ==2:
        print "add full path2"
        os.system('clear')
    elif brute_forcers_answer ==3:
        menu()
        os.system('clear')
    else:
        raw_input("You did not give a valid answer, press any key to try again")
        os.system('clear')

#Define Enumeration Tools
def enumeration_tools():
    os.system('clear')
    prGreen("#########################################################")
    prPurple("Welcome to the t0ast Pentest Menu!")
    prPurple("Choose the appropriate Enumeration tool")
    print ""
    prLightPurple(" 1) Database Tools")
    prLightPurple(" 2) Dir Buster (dirb)")
    prLightPurple(" 3) The Harvester")
    prLightPurple(" 4) Mass Scan")
    prLightPurple(" 5) Multi Purpose Tools")
    prLightPurple(" 6) Network Discover")
    prLightPurple(" 7) NMAP")
    prLightPurple(" 8) Osueta")
    prLightPurple(" 9) Paros")
    prLightPurple("10) Recon-ng")
    prLightPurple("11) Wafw00f")
    prLightPurple("12) Website Tools")
    prYellow("13) Back")
    enumeration_answer = input(":")
    if enumeration_answer ==1:
        os.system('clear')
        database_menu()
    elif enumeration_answer ==2:
        try:
            print "Usage:"
            print "./dirb <url_base> [<wordlist_file(s)>] [options]"
            print ""
            print "Please enter the URL to Test"
            print ""
            url = raw_input()
            url_args = shlex.split(url)
            app = "./tools/4-enumeration-tools/dirb/dirb"
            app_args = shlex.split(app)
            wordlist = "./tools/4-enumeration-tools/dirb/wordlists/common.txt"
            wordlist_args = shlex.split(wordlist)
            s = app_args + url_args + wordlist_args
            x = subprocess.call(s)
        except KeyboardInterrupt:
            os.system('clear')
    elif enumeration_answer ==3:
        print "Run the Harvester"
    elif enumeration_answer ==4:
        print "Run Mass Scan"
    elif enumeration_answer ==5:
        os.system('clear')
        multi_tool_menu()
    elif enumeration_answer ==6:
        try:
            print "Network Discover"
            print "Please Enter the IP Address or Range to scan - PRESS 'ALT+q' To EXIT to Main Menu"
            netdiscover = raw_input("")
            nd = subprocess.call(['/usr/sbin/netdiscover','-r', netdiscover])
            os.system('clear')
        except KeyboardInterrupt:
            os.system('clear')
            enumeration_tools()
    elif enumeration_answer ==7:
        os.system('clear')
        print "###Welcome to the NMAP Command line###"
        print "Enter the host to scan"
        option1 = raw_input(":")
        if workspace ==1:
            a = subprocess.Popen(["/usr/bin/nmap", option1], stdout=absolute_path)
            print a
            print ""
            menu1 = raw_input("Press any key to return to the main menu")
            os.system('clear')
        else:
            b = subprocess.call(["/usr/bin/nmap", option1])
            print b
            print ""
            menu1 = raw_input("Press any key to return to the main menu")
            os.system('clear') 
    elif enumeration_answer ==8:
        print "Osueta"
    elif enumeration_answer ==9:
        print "Paros"
    elif enumeration_answer ==10:
        print "Recon-ng"
    elif enumeration_answer ==11:
        print "wafw00f"
    elif enumeration_answer ==12:
        website_tools_menu()
    elif enumeration_answer ==13:
        menu()
        os.system('clear')
    else:
        raw_input("You did not give a valid answer, press any key to try again")
        os.system('clear')
        database()

#Database Tools
def database_menu():
    os.system('clear')
    prGreen("#########################################################")
    prPurple("Welcome to the t0ast Pentest Menu!")
    prPurple("Choose the appropriate Database Testing Tool")
    print ""
    prLightPurple(" 1) Odat - Oracle Database Attacking Tool")
    prYellow(" 2) Back")
    database_answer = input(":")
    if database_answer ==1:
        print "Odat Menu"
    elif database_answer ==2:
        enumeration_tools()
    else:
        raw_input("You did not give a valid answer, press any key to try again")
        os.system('clear')
        
#Multi Tools Menu
def multi_tool_menu():
    os.system('clear')
    prGreen("#########################################################")
    prPurple("Welcome to the t0ast Pentest Menu!")
    prPurple("Choose the appropriate Multi Purpose Tool")
    print ""
    prLightPurple(" 1) Patator")
    prYellow(" 2) Back")
    multi_tool_answer = input(":")
    if multi_tool_answer ==1:
        print "Run Patator"
    elif multi_tool_answer ==2:
        enumeration_tools()
    else:
        raw_input("You did not give a valid answer, press any key to try again")
        os.system('clear')

#Website Tools
def website_tools_menu():
    os.system('clear')
    prGreen("#########################################################")
    prPurple("Welcome to the t0ast Pentest Menu!")
    prPurple("Choose the appropriate Website Tools")
    print ""
    prLightPurple(" 1) b374k")
    prLightPurple(" 2) Nikto")
    prLightPurple(" 3) Weevely3")
    prLightPurple(" 4) wfuzz")
    prYellow(" 5) Back")
    website_tools_menu_answer = input(":")
    if website_tools_menu_answer ==1:
        print "Run b374k"
    elif website_tools_menu_answer ==2:
        try:
            print "Run Nikto"
            app = "./tools/4-enumeration-tools/nikto/program/nikto.pl"
            app_split = shlex.split(app)
            print "Usage:"
            print ""
            print "Enter the host to test - including 'http' or 'https'"
            url = "-h " + raw_input() + " -C all"
            url_args = shlex.split(url)
            s = app_split + url_args
            os.system('clear')
            prRed("Running Nikto")
            x = subprocess.call(s)
            raw_input("Press any key to return to the menu")
            os.system('clear')
            website_tools_menu()
        except KeyboardInterrupt:
            os.system('clear')
            website_tools_menu()
    elif website_tools_menu_answer ==3:
        print "Run weevely3"
    elif website_tools_menu_answer ==4:
        print "wfuzz"
    elif website_tools_menu_answer ==5:
        os.system('clear')
    else:
        raw_input("You did not give a valid answer, press any key to try again")
        os.system('clear')
    
#Exploitation Tools Menu
def exploitation_tools_menu():
    os.system('clear')
    prGreen("#########################################################")
    prPurple("Welcome to the t0ast Pentest Menu!")
    prPurple("Choose the appropriate Exploit")
    print ""
    prLightPurple(" 1) Metasploit Framework")
    prLightPurple(" 2) w3af - Web Application & Audit Framework")
    prLightPurple(" 3) sqlmap")
    prYellow(" 4) Back")
    exploitation_tools_answer = input(":")
    if exploitation_tools_answer ==1:
        subprocess.call(['./tools/5-exploitation-tools/metasploit-framework/msfupdate'])
        subprocess.call(['./tools/5-exploitation-tools/metasploit-framework/msfconsole'])
        exploitation_tools_menu()
        os.system('clear')
    elif exploitation_tools_answer ==2:
        print "Run w3af"
    elif exploitation_tools_answer ==3:
        print "Run sqlmap"
    elif exploitation_tools_answer ==4:
        os.system('clear')
    else:
        raw_input("You did not give a valid answer, press any key to try again")
        os.system('clear')

#Evasion Tools
def evasion_tools_menu():
    os.system('clear')
    prGreen("#########################################################")
    prPurple("Welcome to the t0ast Pentest Menu!")
    prPurple("Choose the appropriate Evasion Tools")
    print ""
    prLightPurple(" 1) Majic Unicorn")
    prYellow(" 2) Back")
    evasion_tools_answer = input(":")
    if evasion_tools_answer ==1:
        print "Run Patator"
    elif evasion_tools_answer ==2:
        os.system('clear')
    else:
        raw_input("You did not give a valid answer, press any key to try again")
        os.system('clear')

#Password Cracking Tools
def password_cracking_tools_menu():
    os.system('clear')
    prGreen("#########################################################")
    prPurple("Welcome to the t0ast Pentest Menu!")
    prPurple("Choose the Password Cracking Tools")
    print ""
    prLightPurple(" 1) JohnTheRipper")
    prYellow(" 2) Back")
    password_cracking_answer = input(":")
    if password_cracking_answer ==1:
        print "Run John The Ripper"
    elif password_cracking_answer ==2:
        os.system('clear')
    else:
        raw_input("You did not give a valid answer, press any key to try again")
        os.system('clear')

#VPN Tools Menu
def vpn_tools_menu():
    os.system('clear')
    prGreen("#########################################################")
    prPurple("Welcome to the t0ast Pentest Menu!")
    prPurple("Choose the VPN Tools Menu Tools")
    print ""
    prLightPurple(" 1) ikeforce")
    prLightPurple(" 2) ike-scan")
    prYellow(" 3) Back")
    vpn_tools_answer = input(":")
    if vpn_tools_answer ==1:
        print "Run ikeforce"
    elif vpn_tools_answer ==2:
        print "Run ikescan"
    elif vpn_tools_answer ==3:
        os.system('clear')
    else:
        raw_input("You did not give a valid answer, press any key to try again")
        os.system('clear')
        
#Define Option 9 - Update Github Branches in /opt
def git_hub_update():
    print "Update All Github Repos in /opt"
    git = subprocess.call('find /opt -name .git -type d | xargs -n1 -P4 -I% git --git-dir=% --work-tree=%/.. remote update -p', shell=True)
    os.system('clear')


#Input Validation
def inputNumber(message):
    while True:
        try:
            userInput = int(input(message))
        except ValueError:
            print("Not an integer! Try again.")
            continue
        else:
            return userInput
        break
                
loop=True

while loop:
    print menu()
    #mm_answer = raw_input(":")
    mm_answer = inputNumber(":")
    if mm_answer ==0:
        workspace_menu()
    elif mm_answer == 1:
        system_tasks()
    elif mm_answer == 2:
        app_specific_tools_level_1()
    elif mm_answer == 3:
        brute_forcers()
    elif mm_answer == 4:
        enumeration_tools()
    elif mm_answer == 5:
        exploitation_tools_menu()
    elif mm_answer == 6:
        evasion_tools_menu()
    elif mm_answer == 7:
        password_cracking_tools_menu()
    elif mm_answer == 8:
        vpn_tools_menu()
    elif mm_answer == 9:
        git_hub_update()
    elif mm_answer == 11:
        break
    else:
        raw_input("You did not give a valid answer, press any key to try again") 
        os.system('clear')

